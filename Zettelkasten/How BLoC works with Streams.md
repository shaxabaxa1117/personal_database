
	–î–µ–Ω—å : 2025-02-09 
–í—Ä–µ–º—è : 23-08

Status : #Programming  


# üë®‚ÄçüíªHow BLoC works with Streams

### –ö–∞–∫ BLoC –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è?

1. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –≤ BLoC:**  
    –ö–æ–≥–¥–∞ –≤—ã –¥–æ–±–∞–≤–ª—è–µ—Ç–µ —Å–æ–±—ã—Ç–∏–µ –≤ BLoC —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞¬†`add`, –Ω–∞–ø—Ä–∏–º–µ—Ä:
    
```dart
    context.read<AuthBloc>().add(LoginEvent(email: "user@example.com", password: "password"));
```
    

    –≠—Ç–æ —Å–æ–±—ã—Ç–∏–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π¬†`Stream`¬†—Å–æ–±—ã—Ç–∏–π, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ BLoC.
    
2. **–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è:**  
    BLoC –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —ç—Ç–æ—Ç¬†`Stream`¬†—Å–æ–±—ã—Ç–∏–π. –ö–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ BLoC, –æ–Ω–æ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –º–µ—Ç–æ–¥¬†`mapEventToState`¬†(–∏–ª–∏ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏¬†on</Event>¬†–≤ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏—è—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫–∏).
    
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è:**  
    –í–Ω—É—Ç—Ä–∏ –º–µ—Ç–æ–¥–∞¬†`mapEventToState`¬†BLoC –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (`AuthState`), –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤¬†`Stream`¬†—Å–æ—Å—Ç–æ—è–Ω–∏–π —Å –ø–æ–º–æ—â—å—é¬†`yield`.
    
4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI:**  
    UI-—Å–ª–æ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä,¬†`BlocBuilder`¬†–∏–ª–∏¬†`BlocConsumer`) –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞¬†`Stream`¬†—Å–æ—Å—Ç–æ—è–Ω–∏–π BLoC. –ö–æ–≥–¥–∞ BLoC –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, UI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è.
    


---

### –ü–æ—á–µ–º—É —Å–æ–±—ã—Ç–∏–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç?

–ö–æ–≥–¥–∞ –≤—ã –¥–æ–±–∞–≤–ª—è–µ—Ç–µ —Å–æ–±—ã—Ç–∏–µ –≤ BLoC —Å –ø–æ–º–æ—â—å—é¬†`add`, –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–ª–µ–¥—É—é—â–µ–µ:

1. **–°–æ–±—ã—Ç–∏–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤¬†`Stream`¬†—Å–æ–±—ã—Ç–∏–π:**  
    BLoC –≤–Ω—É—Ç—Ä–∏ —Å–µ–±—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç¬†`StreamController`¬†–¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Ç–æ–∫–æ–º —Å–æ–±—ã—Ç–∏–π. –ö–æ–≥–¥–∞ –≤—ã –≤—ã–∑—ã–≤–∞–µ—Ç–µ¬†`add`, —Å–æ–±—ã—Ç–∏–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ —ç—Ç–æ—Ç¬†`StreamController`.
    
2. **BLoC –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞¬†`Stream`¬†—Å–æ–±—ã—Ç–∏–π:**  
    BLoC –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞¬†`Stream`¬†—Å–æ–±—ã—Ç–∏–π, –∫–æ—Ç–æ—Ä—ã–π –æ–Ω —Å–∞–º –∂–µ –∏ —Å–æ–∑–¥–∞–µ—Ç. –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏¬†`flutter_bloc`.
    
3. **–°–æ–±—ã—Ç–∏–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤¬†`mapEventToState`:**  
    –ö–∞–∂–¥–æ–µ –Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ –∏–∑¬†`Stream`¬†—Å–æ–±—ã—Ç–∏–π –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –º–µ—Ç–æ–¥¬†`mapEventToState`, –≥–¥–µ –æ–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è.
    
4. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π:**  
    –í–Ω—É—Ç—Ä–∏¬†`mapEventToState`¬†–≤—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç–µ —Å–æ–±—ã—Ç–∏–µ –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç–µ –Ω–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å –ø–æ–º–æ—â—å—é¬†`yield`. –≠—Ç–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤¬†`Stream`¬†—Å–æ—Å—Ç–æ—è–Ω–∏–π, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–ø–∏—Å–∞–Ω UI.
    

---

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–Ω—É—Ç—Ä–∏ BLoC?

–í–æ—Ç —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Å—Ö–µ–º–∞ —Ç–æ–≥–æ, –∫–∞–∫ BLoC —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–Ω—É—Ç—Ä–∏:

1. **`StreamController`¬†–¥–ª—è —Å–æ–±—ã—Ç–∏–π:**  
    BLoC —Å–æ–∑–¥–∞–µ—Ç¬†`StreamController`, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ—Ç–æ–∫–æ–º —Å–æ–±—ã—Ç–∏–π (`AuthEvent`).
    
2. **`StreamController`¬†–¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏–π:**  
    BLoC —Ç–∞–∫–∂–µ —Å–æ–∑–¥–∞–µ—Ç¬†`StreamController`, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ—Ç–æ–∫–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–π (`AuthState`).
    
3. **–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è:**  
    BLoC –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞¬†`Stream`¬†—Å–æ–±—ã—Ç–∏–π –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç –∫–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ –≤ –º–µ—Ç–æ–¥¬†`mapEventToState`.
    
4. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π:**  
    –í–Ω—É—Ç—Ä–∏¬†`mapEventToState`¬†–≤—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç–µ —Å–æ–±—ã—Ç–∏–µ –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤¬†`Stream`¬†—Å–æ—Å—Ç–æ—è–Ω–∏–π.
    
5. **–ü–æ–¥–ø–∏—Å–∫–∞ UI –Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è:**  
    UI-—Å–ª–æ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä,¬†`BlocBuilder`) –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞¬†`Stream`¬†—Å–æ—Å—Ç–æ—è–Ω–∏–π –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è, –∫–æ–≥–¥–∞ BLoC –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.


---

 ## –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã BLoC
 
  1. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è:**
```dart	
context.read<AuthBloc>().add(LoginEvent(email: "user@example.com", password:"password"));
```
  2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è –≤ BLoC:**
  ```dart
  @override
Stream<AuthState> mapEventToState(AuthEvent event) async* {
  if (event is LoginEvent) {
    yield AuthLoading(); // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
    await Future.delayed(Duration(seconds: 2)); // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏
    if (event.email == "user@example.com" && event.password == "password") {
      yield AuthAuthenticated(user: User(email: event.email, token: "dummy_token")); // –£—Å–ø–µ—à–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
    } else {
      yield AuthError(message: "Invalid credentials"); // –û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
    }
  }
}
```
 3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI:**

```dart
BlocBuilder<AuthBloc, AuthState>(
  builder: (context, state) {
    if (state is AuthLoading) {
      return CircularProgressIndicator();
    } else if (state is AuthAuthenticated) {
      return Text("Welcome, ${state.user.email}!");
    } else if (state is AuthError) {
      return Text("Error: ${state.message}");
    } else {
      return LoginForm();
    }
  },
)
```

---
# References

